#!/usr/bin/python2
#
# Server to receive malware.tmp info
#
# @author Brian Hession
# @email bhession@gmu.edu
#

from __future__ import print_function
import sys, socket

data = sys.stdin.read()
while len(data) < 0x4C:
    data += data
data = str(data[:0x4C])
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect(('localhost', 5555))
try:
    sock.sendall(data)
    cmd = bytearray()
    while len(cmd) < 0x70:
        data = sock.recv(0x70 - len(data))
        if data:
            cmd += bytearray(data)
        else:
            sock.close()
            sys.exit(0)
    print('Received {:02x}h bytes'.format(len(data)))
    print('Data:', ''.join(['\\x{:02x}'.format(b) for b in data]))
finally:
    sock.close()
